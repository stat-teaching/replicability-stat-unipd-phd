{
  "hash": "adf3fb1a98275827adc4707f7a7f54e6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Multiverse\nsubtitle: Replicability Crisis in Science?\ncode-fold: true\n---\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n\n# Multiverse analysis {.section}\n\n## Multiverse analysis @Steegen2016-lz\n\n- Even a simple data analysis is characterized by several (often arbitrary) choices\n- The impact of these choices is not always clear, known or easy to predict\n- Researchers (with or without awareness) usually report a single set of choices \n\n## Some examples\n\n- using a predictor as continous or choosing some thresholds and transforming to categorical\n- including or excluding an observation (e.g., outlier)\n- including or excluding a covariate (e.g., controlling for age or not)\n- using a linear model or an ordinal regression for discrete ordered data\n- ...\n\n## The garden of forking paths\n\nA tree of possibilities...\n\n![](img/forking-paths.svg)\n\n## The garden of forking paths\n\n... Where only some of them produce a certain result.\n\n![](img/forking-paths-color.svg)\n\n\n## Only plausible vs all scenarios\n\nNot all scenarios are equally plausible or reasonable. Thus the multiverse is not the entire set but a non-random sample of plausibile choices.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nx <- seq(0, 1, 0.0001)\ny <- dexp(x, 2)\ny <- (y-min(y))/(max(y)-min(y))\n\nplot(x*100, y, type = \"l\",\n     xlab = \"All possible scenarios\",\n     ylab = \"Plausibility\",\n     lwd = 2)\n```\n\n::: {.cell-output-display}\n![](04-multiverse-meta-analysis_files/figure-revealjs/unnamed-chunk-2-1.svg){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n# Multiverse meta-analysis {.section}\n\n## Meta-analysis many choices\n\nDespite useful and very powerful, meta-analysis is characterized by several (arbitrary) choices. For example:\n\n- Should the study $x$ be excluded for theoretical or statistical (e.g., outliers) reasons?\n- Should we use an equal or random-effects model?\n- Which value should take the pre-post missing correlation?\n- ...\n\n## An example: Pre-post Cohen's $d$\n\nWith a pre-post Cohen's $d$ we need the pre-post correlation $\\rho$ to calculate the sampling variance:\n\n$$\n\\sigma^2_{\\epsilon_{pp}} = \\frac{2(1 - \\rho)}{n} + \\frac{d^2}{2n}\n$$\n\n$\\rho$ is usually non reported and need to be chosen from previous literature or a plausible guess.\n\n## Pre-post Cohen's $d$\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nv_dm <- function(r, d, n){\n    2*(1-r)/n + d^2/(2*n)\n}\n\nvdd <- data.frame(x = seq(-1, 1, 0.001))\nvdd$y <- v_dm(vdd$x, 0, 40)\n\nggplot(vdd, aes(x = x, y = y)) +\n    geom_line() +\n    xlab(expression(rho)) +\n    ylab(expression(sigma^2)) +\n    theme_minimal(25)\n```\n\n::: {.cell-output-display}\n![](04-multiverse-meta-analysis_files/figure-revealjs/unnamed-chunk-3-1.svg){fig-align='center' width=100%}\n:::\n:::\n\n\n\n\n## A simulated example\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np_beta <- ggplot(pimaex, aes(y = b)) +\n    xlim(c(-0.5,0.5)) +\n    geom_boxplot(width = 0.5,\n                 fill = \"dodgerblue\",\n                 alpha = 0.6) + \n    ylab(latex2exp::TeX(\"$\\\\mu_{\\\\,\\\\, \\\\theta}$\")) +\n    theme_minimal(30) +\n    theme(axis.text.x = element_blank())\n\np_pval <- ggplot(pimaex, aes(y = -log10(p.value))) +\n    xlim(c(-0.5,0.5)) +\n    geom_hline(yintercept = -log10(0.05)) +\n    geom_boxplot(width = 0.5,\n                 fill = \"dodgerblue\",\n                 alpha = 0.6) + \n    ylab(latex2exp::TeX(\"Raw $-log_{10}(p)$\")) +\n    theme_minimal(30) +\n    theme(axis.text.x = element_blank())\n\ncowplot::plot_grid(p_beta, p_pval, nrow = 1)\n```\n\n::: {.cell-output-display}\n![](04-multiverse-meta-analysis_files/figure-revealjs/unnamed-chunk-4-1.svg){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n## An example from @Plessen2023-ex\n\n![](img/plessen2023.png)\n\n## An example from @Plessen2023-ex\n\n- Over the last four decades, more than 80 meta-analyses have examined the efficacy of psychotherapies for depression\n- More than 700 randomised controlled trials (RCTs)\n- Not all these studies goes in the same direction\n\n## An example from @Plessen2023-ex\n\nDiscrepancies in results could be due to:\n\n### Which factors (which data to meta-analyze)\n\n- inclusion/esclusion of a subset of studies (e.g., low quality studies)\n- type of control group or control therapy\n- ...\n\n### How factors (how to meta-analyze)\n\n- type of model (e.g., equal vs random)\n- model complexity (two-level, three level, robust, etc.)\n- correcting for publication bias\n\n# Descriptive tools {.section}\n\n## Describing the multiverse\n\n@Hall2022-mp and @Liu2021-xv proposed several tools to describe the results of a multiverse analysis.\n\nThe increase in complexity NEED to be managed using appropriate tools to summarise and visualize the results.\n\n## Estimated effect of interest\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nspecif_res |> \n  ggplot(aes(x = b)) +\n  geom_histogram(bins = 50,\n                 fill = \"dodgerblue\",\n                 col = \"black\") +\n  ylab(\"Frequency\") +\n  xlab(\"Estimated Effect\") +\n  geom_vline(xintercept = 0, col = \"red\") +\n  geom_vline(xintercept = 0.25, col = \"green\")\n```\n\n::: {.cell-output-display}\n![](04-multiverse-meta-analysis_files/figure-revealjs/unnamed-chunk-5-1.svg){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n## Estimated effect as a function of scenarios\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nabove <- specif_res |> \n  arrange(b) |> \n  mutate(id = 1:n()) |> \n  ggplot(aes(x = id, y = b)) +\n  geom_segment(aes(xend = id, y = ci.lb, yend = ci.ub)) +\n  geom_hline(yintercept = 0, col = \"red\") +\n  geom_hline(yintercept = 0.25, col = \"green\") +\n  theme(axis.title.y = element_blank(),\n        axis.text.x = element_blank(),\n        axis.title.x = element_blank())\n  \nbelow <- specif_res |> \n  arrange(b) |> \n  mutate(id = 1:n()) |> \n  pivot_longer(c(\n    target_group,\n    format,\n    diagnosis,\n    risk_of_bias,\n    type,\n    method\n  )) |> \n  ggplot(aes(x = id, y = value)) +\n  geom_raster() +\n  theme(axis.title.y = element_blank(),\n        axis.text.x = element_blank()) +\n  xlab(\"Specification\")\n\nplot_grid(above, below, nrow = 2, align = \"hv\")\n```\n\n::: {.cell-output-display}\n![](04-multiverse-meta-analysis_files/figure-revealjs/unnamed-chunk-6-1.svg){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n## Fixing a specific parameter\n\nWe can the effect of a set of scenarios having a certain parameter:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nspecif_res |> \n  arrange(b) |> \n  mutate(id = 1:n()) |> \n  ggplot(aes(x = b, fill = diagnosis)) +\n  geom_density(alpha = 0.5)\n```\n\n::: {.cell-output-display}\n![](04-multiverse-meta-analysis_files/figure-revealjs/unnamed-chunk-7-1.svg){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n# Inferential tools {.section}\n\n## Specification Curve @Simonsohn2020-sr\n\nThe idea of the specification curve is both descriptive (see previous plots) and inferential.\n\nInferentially, the approach requires to generate a new dataset under the null hypothesis and compare with the observed value.\n\n## Specification Curve in meta-analysis @Plessen2023-ex\n\n@Plessen2023-ex describe how to implement the method for meta-analysis.\n\n1. For each dataset/model generate $k_s$ data (where $k$ is the number of effect in the specification $s$) sampling from $\\mathcal{N}(0,\\sigma^2_{\\epsilon_i} + \\tau^2)$.\n2. Fit the model (FE or RE)\n3. Get the specification curve\n4. Repeat 1-3 for a large number of times (e.g., 1000)\n5. Compute the 2.5% and 95.75% quantiles\n6. Check if the observed specification is outside the 95% CI\n\n## Specification Curve in meta-analysis @Plessen2023-ex\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nspecif$SD |> \n  filter(spec %in% sample(1:1000, 1)) |> \n  ggplot(aes(x = id, y = b)) +\n  geom_line(aes(group = spec))\n```\n\n::: {.cell-output-display}\n![](04-multiverse-meta-analysis_files/figure-revealjs/unnamed-chunk-8-1.svg){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n## Specification Curve in meta-analysis @Plessen2023-ex\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nspecif$SD |> \n  filter(spec %in% sample(1:1000, 1)) |> \n  ggplot(aes(x = id, y = b)) +\n  geom_line(aes(group = spec))\n```\n\n::: {.cell-output-display}\n![](04-multiverse-meta-analysis_files/figure-revealjs/unnamed-chunk-9-1.svg){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n## Specification Curve in meta-analysis @Plessen2023-ex\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nspecif$SD |> \n  filter(spec %in% sample(1:1000, 1)) |> \n  ggplot(aes(x = id, y = b)) +\n  geom_line(aes(group = spec))\n```\n\n::: {.cell-output-display}\n![](04-multiverse-meta-analysis_files/figure-revealjs/unnamed-chunk-10-1.svg){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n## Specification Curve in meta-analysis @Plessen2023-ex\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nspecif_res <- specif_res |> \n  arrange(b) |> \n  mutate(id = 1:n())\n\nggplot(data = specif$SD,\n       aes(x = id, y = b)) +\n  geom_line(aes(group = spec)) +\n  geom_line(data = specif_res,\n            aes(x = id, y = b),\n            col = \"firebrick\",\n            lwd = 2)\n```\n\n::: {.cell-output-display}\n![](04-multiverse-meta-analysis_files/figure-revealjs/unnamed-chunk-11-1.svg){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n## PIMA\n\n**P**-selection **I**nference in **M**ultiverse **M**eta-analysis (PIMA) is an inferential approach to multiverse analysis is an inferential framework for:\n\n- obtaining an overall p-value across the multiverse\n- obtaining corrected p-values based on resampling methods\n\n## PIMA [@Girardi2024-ip]\n\n![](img/girardi2024.pdf){width=80% fig-align=\"center\"}\n\n## PIMA on meta-analysis\n\nWe implemented PIMA also on meta-analysis but (for the moment) limited to two-level models without moderators.\n\n![](img/wip.jpg)\n\n## The main advantage of PIMA\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntp <- function(p){\n    -log10(p)\n}\n\nlbl <- c(\"Never $p \\\\leq 0.05$\", \n         \"Before correction $p \\\\leq 0.05$\", \n         \"After correction $p \\\\leq 0.05$\")\n\n\npimaex$sign <- factor(pimaex$sign, \n                     labels = latex2exp::TeX(lbl))\n\nggplot(pimaex, aes(x = tp(p.value), tp(adjust.maxt), color = sign)) +\n    geom_hline(yintercept = tp(0.05), alpha = 0.4) +\n    geom_vline(xintercept = tp(0.05), alpha = 0.4) +\n    geom_abline(linetype = \"dashed\", lwd = 0.5) +\n    geom_point(size = 5,\n               position = position_jitter(width = 0.1),\n               alpha = 0.5) +\n    xlim(c(0, 3)) +\n    ylim(c(0, 3)) +\n    xlab(TeX(\"Raw p value ($-log_{10}$)\")) +\n    ylab(TeX(\"Corrected p value\")) +\n    theme_minimal(base_size = 20) +\n    theme(legend.title = element_blank(),\n          legend.position = \"bottom\") +\n    scale_color_manual(labels = scales::parse_format(), values = c(\"#F8766D\", \"#7CAE00\", \"#00BFC4\"))\n```\n\n::: {.cell-output-display}\n![](04-multiverse-meta-analysis_files/figure-revealjs/unnamed-chunk-12-1.svg){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n# Important aspects of multiverse analysis {.section}\n\n## Important aspects of multiverse analysis\n\n- Include only plausible scenarios. Regardless the aim (description or inference) of the multiverse, the results are meaningful if and only if scenarios are plausible.\n- Scenarios are assumed to be equally plausible but we could imagine a plausibility weight (future direction)\n- Multiverse analysis is also useful to estimate the degree of variability according to plausible choices\n\n# Some other multiverse examples and resources {.section}\n\n## R Packages\n\n- https://mucollective.github.io/multiverse/\n- https://mverseanalysis.github.io/mverse/\n- https://github.com/uwdata/boba\n\n## Multiverse projects\n\n- @Dafflon2022-zl implemented a multiverse analysis for neuroimaging data\n- @Hoogeveen2023-dw implemented a Bayesian multiverse analysis within the Many Labs 4 project (a large scale replication project in Psychology)\n- @Olsson-Collentine2023-sj re-analyzed some replication projects using a multiverse approach\n\n## Multiverse is catchy!\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmulti_cit <- data.frame(\n        year = c(2024L,2023L,2022L,2021L,2020L,2019L,\n                 2018L,2017L,2016L,2015L,2014L,2013L),\n      papers = c(30L, 46L, 33L, 19L, 10L, 11L, 4L, 2L, 3L, 0L, 1L, 1L),\n       total = c(652674L,1295092L,1317981L,1299609L,\n                 1161910L,1044346L,955091L,907118L,874112L,840256L,804004L,\n                 777242L)\n)\n\nmulti_cit |> \n    mutate(year = as.integer(year)) |> \n    ggplot(aes(x = year, y = papers/total)) +\n    geom_line() +\n    geom_label(aes(label = papers)) +\n    scale_x_continuous(breaks = seq(2012, 2024, 1)) +\n    theme(axis.title.x = element_blank(),\n          axis.text.y = element_blank(),\n          axis.ticks.y = element_blank()) +\n    ylab(\"# papers on Multiverse\")\n```\n\n::: {.cell-output-display}\n![](04-multiverse-meta-analysis_files/figure-revealjs/unnamed-chunk-13-1.svg){fig-align='center' width=960}\n:::\n:::\n\n\n\n\n## References",
    "supporting": [
      "04-multiverse-meta-analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}