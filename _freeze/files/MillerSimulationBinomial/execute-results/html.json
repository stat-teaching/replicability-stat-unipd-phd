{
  "hash": "1de81744235f0cf8a47b30e8e10d0ab5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Probability of Replication\"\nformat: html\neditor: visual\n---\n\n\nProbability of replication of a Binomial test for simple versus simple hypothesis. Inspired by Miller's paper.\n\nModel: $x$ is Binomial $\\theta$. There are two possible values of $\\theta$ the null value $\\theta_0$ and the alternative $\\theta_1$. Both the original and replicated experiment have size $n$. We know $\\gamma$.\n\nThe logic is this:\n\n\\-- compute the power $(1-\\beta$) of the studies (it is the same for both) by simulation\n\n\\-- for ever possible $x$ in $0, \\ldots, n$ compute the p-value and the posterior probability of the null $\\theta=\\theta_0$\n\n\\-- if the $x$ leads to a rejection compute the probability of replication as $\\alpha/2 * p(\\theta_0|x) + (1-\\beta) (1-p(\\theta_0|x))$\n\n\\-- if the $x$ does not lead to a rejection compute the probability of replication as $(1-\\alpha) * p(\\theta_0|x) + \\beta (1-p(\\theta_0|x))$\n\nFunction to compute the probability of replication.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprobrep = function(\n  nn, # sample size of both the initial and replication experiment\n  gamma, # prior probability of the hypothesis\n  theta0, # success probability under the null hypothesis\n  theta1, # success probability under the null hypothesis\n  alpha # significance cutoff\n){\n  x1range = seq(0,nn) # possible values of original experiment\n  pvalue1 = pH0 = rep(NA,nn+1) # initialization\n# type two error estimation via quick simulation\n  MM = 10000\n  xx.under.alt = rbinom(MM,nn,theta1)\n  pvalue.alt = NA\n  for (mm in 1:MM){\n  pvalue.alt[mm] = binom.test(xx.under.alt[mm],nn,theta0,alternative=\"two.sided\")$p.value\n}\n  beta = mean( pvalue.alt > .05) # type one error in both studies\n#\n\nfor (xx in x1range){\n# mapping between number of successes and pvalue in original ezxperiment\n  pvalue1[xx] = \n    binom.test(xx,nn,theta0,alternative=\"two.sided\")$p.value\n# probability of null hypothesis given first experiment\n  pH0[xx] = gamma * dbinom(xx,nn,theta0) / \n    ( gamma * dbinom(xx,nn,theta0) + (1-gamma) * dbinom(xx,nn,theta1))\n}\n# set tiny p-values to e-20 for visualization purposes\n  pvalue1[is.na(pvalue1)] = 0\n  pH0[is.na(pH0)] = 0\n  # separate rejections \n  xx.reject = x1range[ pvalue1 < .05 ] + 1\n  xx.retain = x1range[ pvalue1>=.05 ] + 1\n  pvalue.reject = pvalue1[xx.reject]  \n  pvalue.retain = pvalue1[xx.retain]\n  pH0.reject = pH0[xx.reject]  \n  pH0.retain = pH0[xx.retain]\n  \n#  browser()\n\n  # compute replication probabilitie\n  prep.reject = (alpha/2) * pH0[xx.reject] + (1-beta) * (1-pH0[xx.reject])\n  prep.retain = (1-alpha) * pH0[xx.retain] + beta * (1-pH0[xx.retain])\n\n  return(list(\n    reject = na.omit(data.frame(prep.reject,pvalue.reject,pH0.reject)),\n    retain = na.omit(data.frame(prep.retain,pvalue.retain,pH0.retain))))\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprobrep.out = probrep(nn=20,gamma=.5,theta0=.1,theta1=.2,alpha=0.05)\nplot(probrep.out$reject$pvalue.reject,\n     probrep.out$reject$prep.reject,\n     ylab=\"probability of replication\",\n     xlab=\"p-value of original study\")\n```\n\n::: {.cell-output-display}\n![](MillerSimulationBinomial_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(probrep.out$reject$pvalue.reject,\n     probrep.out$reject$pH0.reject,\n     ylab=\"probability of null hypothesis\",\n     xlab=\"p-value of original study\")\n```\n\n::: {.cell-output-display}\n![](MillerSimulationBinomial_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(probrep.out$retain$pvalue.retain,\n     probrep.out$retain$prep.retain,\n     ylab=\"probability of replication\",\n     xlab=\"p-value of original study\")\n```\n\n::: {.cell-output-display}\n![](MillerSimulationBinomial_files/figure-html/unnamed-chunk-2-3.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(probrep.out$retain$pvalue.retain,\n     probrep.out$retain$pH0.retain,\n     ylab=\"probability of null hypothesis\",\n     xlab=\"p-value of original study\")\n```\n\n::: {.cell-output-display}\n![](MillerSimulationBinomial_files/figure-html/unnamed-chunk-2-4.png){width=672}\n:::\n:::\n",
    "supporting": [
      "MillerSimulationBinomial_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}